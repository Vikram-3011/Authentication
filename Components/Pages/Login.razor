@page "/"
@inject AuthService Auth
@inject NavigationManager Nav
@using MudBlazor
@rendermode InteractiveServer

<MudPaper Class="auth-card">
    <MudText Typo="Typo.h5" Class="mb-4">Log in</MudText>

    <MudTextField @bind-Value="email" Label="Email" Variant="Variant.Outlined" Required />
    <MudTextField @bind-Value="password" Label="Password" Variant="Variant.Outlined" InputType="InputType.Password" Required />

    @if (!string.IsNullOrEmpty(error))
    {
        <MudText Color="Color.Error" Typo="Typo.caption">@error</MudText>
    }

    <MudButton Class="mt-4" Variant="Variant.Filled" OnClick="LoginAsync">Log in</MudButton>
    <MudText Class="mt-2"><MudLink Href="/signup">Need an account?</MudLink></MudText>
</MudPaper>

<style>

    .auth-card {
        width: 350px;
        margin: auto;
        margin-top: 15vh;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
    }

</style>
@code {
    private string email = "";
    private string password = "";
    private string? error;

    private async Task LoginAsync()
    {
        error = null;

        var (success, err) = await Auth.SignInAsync(email, password);

        if (success)
            Nav.NavigateTo("/home");
        else
            error = err ?? "Login failed.";
    }
}
